<!DOCTYPE html>
<html th:replace="~{_layout::layout(title='Nhật Ký Tuần Tra', content=~{::content}, currentPage='logs')}"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<th:block th:fragment="content">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Nhật Ký Tuần Tra</h1>
            <p class="text-gray-600 mt-2">Lịch sử các lần quét mã tại tất cả các điểm.</p>
        </div>
        <a sec:authorize="hasAuthority('ROLE_ADMIN')" th:href="@{/admin/logs/new}"
           class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 font-medium flex items-center shadow-sm hover:shadow-md">
            <i class="fas fa-plus mr-2"></i> Thêm Nhật ký Thủ công
        </a>
    </div>

    <div th:if="${successMessage}" class="mb-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-r-lg" role="alert" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="mb-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-r-lg" role="alert" th:text="${errorMessage}"></div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <form th:action="@{/admin/logs}" method="get">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="lg:col-span-2">
                    <label for="keyword" class="block text-sm font-medium text-gray-700 mb-1">Từ khóa</label>
                    <input type="text" id="keyword" name="keyword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500" placeholder="Vị trí hoặc người quét..." th:value="${keyword}">
                </div>
                <div>
                    <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Từ ngày</label>
                    <input type="date" id="startDate" name="startDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500" th:value="${startDate}">
                </div>
                <div>
                    <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">Đến ngày</label>
                    <input type="date" id="endDate" name="endDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500" th:value="${endDate}">
                </div>
            </div>
            <div class="mt-4 flex justify-end">
                <button type="submit" class="bg-gray-800 text-white px-6 py-2 rounded-lg hover:bg-gray-900 font-medium flex items-center"><i class="fas fa-search mr-2"></i>Tìm kiếm</button>
            </div>
        </form>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left font-semibold text-gray-600 uppercase tracking-wider">Thời gian quét</th>
                    <th class="px-6 py-3 text-left font-semibold text-gray-600 uppercase tracking-wider">Vị trí</th>
                    <th class="px-6 py-3 text-left font-semibold text-gray-600 uppercase tracking-wider">Người quét</th>
                    <th sec:authorize="hasAuthority('ROLE_ADMIN')" class="px-6 py-3 text-center font-semibold text-gray-600 uppercase tracking-wider">Hành động</th>
                </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                <tr th:each="log : ${logPage.content}" class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 text-gray-900" th:text="${#temporals.format(log.scannedAt, 'dd-MM-yyyy HH:mm:ss')}"></td>
                    <td class="px-6 py-4 font-medium text-gray-900" th:text="${log.locationName}"></td>
                    <td class="px-6 py-4 text-gray-600" th:text="${log.scannerName}"></td>
                    <td sec:authorize="hasAuthority('ROLE_ADMIN')" class="px-6 py-4 text-center">
                        <div class="flex justify-center items-center space-x-2">
                            <a th:href="@{/admin/logs/edit/{idPatrolLog}(idPatrolLog=${log.idPatrolLog})}"
                               class="w-8 h-8 rounded-full flex items-center justify-center bg-yellow-100 text-yellow-600 hover:bg-yellow-200"
                               title="Sửa">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a th:href="@{/admin/logs/delete/{idPatrolLog}(idPatrolLog=${log.idPatrolLog})}"
                               class="w-8 h-8 rounded-full flex items-center justify-center bg-red-100 text-red-600 hover:bg-red-200"
                               title="Xóa"
                               onclick="return confirm('Bạn có chắc chắn muốn xóa nhật ký này không?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                <tr th:if="${logPage.isEmpty()}">
                    <td th:attr="colspan=${#authorization.expression('hasAuthority(''ROLE_ADMIN'')') ? 4 : 3}" class="px-6 py-12 text-center text-gray-500">
                        <div class="flex flex-col items-center"><i class="fas fa-inbox text-4xl text-gray-300 mb-3"></i><p>Không có nhật ký nào</p></div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div th:if="${logPage != null && logPage.totalPages > 0}" class="border-t border-gray-200 bg-white px-4 py-3 flex items-center justify-between sm:px-6">
            <div class="text-sm text-gray-700">Hiển thị <span class="font-semibold" th:text="${logPage.number * logPage.size + 1}"></span> đến <span class="font-semibold" th:text="${logPage.number * logPage.size + logPage.numberOfElements}"></span> trong <span class="font-semibold" th:text="${logPage.totalElements}"></span> mục</div>
            <nav th:if="${logPage.totalPages > 1}" class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
                <a th:href="@{/admin/logs(page=${logPage.number - 1}, keyword=${keyword}, startDate=${startDate}, endDate=${endDate})}" th:classappend="${logPage.first} ? 'pointer-events-none opacity-50'" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"><i class="fas fa-chevron-left"></i></a>
                <th:block th:each="i : ${#numbers.sequence(T(java.lang.Math).max(0, logPage.number - 2), T(java.lang.Math).min(logPage.totalPages - 1, logPage.number + 2))}"><a th:href="@{/admin/logs(page=${i}, keyword=${keyword}, startDate=${startDate}, endDate=${endDate})}" th:classappend="${i == logPage.number} ? 'z-10 bg-primary-50 border-primary-500 text-primary-600' : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50'" class="relative inline-flex items-center px-4 py-2 border text-sm font-medium" th:text="${i + 1}"></a></th:block>
                <a th:href="@{/admin/logs(page=${logPage.number + 1}, keyword=${keyword}, startDate=${startDate}, endDate=${endDate})}" th:classappend="${logPage.last} ? 'pointer-events-none opacity-50'" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"><i class="fas fa-chevron-right"></i></a>
            </nav>
        </div>
    </div>
</th:block>
</html>